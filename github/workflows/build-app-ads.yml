name: Build app-ads.txt

on:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Generate app-ads.txt
        run: |
          echo "# AUTO-GENERATED app-ads.txt" > app-ads.txt
          echo "# DO NOT EDIT THIS FILE DIRECTLY" >> app-ads.txt
          echo "# Edit files in /networks/ instead" >> app-ads.txt
          echo "" >> app-ads.txt

          for file in networks/*.txt; do
            echo "# --------------------------------------------------" >> app-ads.txt
            echo "# Imported from: $file" >> app-ads.txt
            echo "# --------------------------------------------------" >> app-ads.txt
            cat "$file" >> app-ads.txt
            echo "" >> app-ads.txt
          done

      - name: Remove duplicate lines
        run: |
          sort app-ads.txt | uniq > app-ads-clean.txt
          mv app-ads-clean.txt app-ads.txt

      - name: Commit changes
        run: |
          git config --global user.email "action@github.com"
          git config --global user.name "GitHub Action"
          git add app-ads.txt
          git commit -m "Update auto-generated app-ads.txt" || echo "No changes to commit"
          git push
